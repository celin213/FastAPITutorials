**[üá¨üáß English version](README.md)**

# –ü—Ä–∏–º–µ—Ä 04: –†–∞–±–æ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –≤ FastAPI

## üìö –ß—Ç–æ –∏–∑—É—á–∞–µ–º

- ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤** - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞, –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è)
- ‚úÖ **PIL/Pillow** - —Ä–∞–±–æ—Ç–∞ —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ **–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤** - –æ—Ç–¥–∞—á–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ **–ü–æ—Ç–æ–∫–æ–≤—ã–π –æ—Ç–≤–µ—Ç** - –ø–æ—Ç–æ–∫–æ–≤–∞—è –æ—Ç–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã** - —Ä–∞–∑–¥–∞—á–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ **–†–∞–±–æ—Ç–∞ —Å –ø—É—Ç—è–º–∏** - —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install fastapi uvicorn pillow python-multipart

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
cd example_04
python main.py
# –∏–ª–∏
uvicorn main:app --reload
```

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `http://localhost:8000/docs`

---

## üñºÔ∏è –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ curl
curl -X POST "http://localhost:8000/upload/" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@photo.jpg"

# –û—Ç–≤–µ—Ç:
{
  "filename": "photo.jpg",
  "size_bytes": 245678,
  "format": "JPEG",
  "width": 1920,
  "height": 1080
}
```

**Swagger UI:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/docs` –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```bash
curl -X POST "http://localhost:8000/process/resize/" \
  -H "Content-Type: application/json" \
  -d '{
    "filename": "photo.jpg",
    "width": 800,
    "height": 600
  }'

# –û—Ç–≤–µ—Ç:
{
  "message": "Image resized successfully",
  "output_file": "resized_800x600_photo.jpg",
  "download_url": "/download/resized_800x600_photo.jpg"
}
```

### 3. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞

```bash
curl -X POST "http://localhost:8000/process/convert/" \
  -H "Content-Type: application/json" \
  -d '{
    "filename": "photo.jpg",
    "format": "PNG"
  }'

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç JPEG ‚Üí PNG
```

### 4. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```bash
# –°–∫–∞—á–∞—Ç—å –∫–∞–∫ –≤–ª–æ–∂–µ–Ω–∏–µ
curl "http://localhost:8000/download/resized_800x600_photo.jpg" \
  --output image.jpg

# –ò–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
# http://localhost:8000/download/resized_800x600_photo.jpg
```

### 5. –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```bash
# –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä, –±–µ–∑ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è)
# http://localhost:8000/preview/resized_800x600_photo.jpg
```

### 6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä—ã

```bash
# –ú–∏–Ω–∏–∞—Ç—é—Ä–∞ "–Ω–∞ –ª–µ—Ç—É" (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –¥–∏—Å–∫)
curl "http://localhost:8000/thumbnail/photo.jpg?size=150" \
  --output thumb.png
```

### 7. –°–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

```bash
curl "http://localhost:8000/list/"

# –û—Ç–≤–µ—Ç:
{
  "uploaded": ["photo.jpg", "image.png"],
  "processed": ["resized_800x600_photo.jpg"]
}
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
example_04/
‚îú‚îÄ‚îÄ main.py          # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ README.md        # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ requirements.txt # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ uploads/         # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îî‚îÄ‚îÄ processed/       # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

---

## üîç –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

```python
@app.post("/upload/")
async def upload_image(file: UploadFile = File(...)):
    # –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
    if not file.content_type.startswith("image/"):
        raise HTTPException(400, "File must be an image")

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    with open(f"uploads/{file.filename}", "wb") as buffer:
        shutil.copyfileobj(file.file, buffer)
```

**–í–∞–∂–Ω–æ:**
- `UploadFile` - —Ç–∏–ø FastAPI –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
- `File(...)` - –ø–æ–º–µ—á–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–∞–∫ –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞
- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–∞–∫–µ—Ç `python-multipart`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é PIL

```python
from PIL import Image

# –û—Ç–∫—Ä—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
with Image.open("photo.jpg") as img:
    # –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä
    img.thumbnail((800, 600), Image.Resampling.LANCZOS)

    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç
    img.save("output.png", format="PNG")

    # –ü–æ–ª—É—á–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    width, height = img.size
    format = img.format
```

### –¢–∏–ø—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è —Ñ–∞–π–ª–æ–≤

**1. FileResponse** - –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤:
```python
return FileResponse(
    path="image.jpg",
    filename="download.jpg",  # –ò–º—è –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏
    media_type="application/octet-stream"  # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
)
```

**2. StreamingResponse** - –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö:
```python
img_bytes = io.BytesIO()
img.save(img_bytes, format='PNG')
img_bytes.seek(0)

return StreamingResponse(img_bytes, media_type="image/png")
```

**3. Static Files** - –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤:
```python
app.mount("/static", StaticFiles(directory="processed"), name="static")
# –î–æ—Å—Ç—É–ø: http://localhost:8000/static/image.jpg
```

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø—É—Ç—è–º–∏

```python
from pathlib import Path

UPLOAD_DIR = Path("uploads")
UPLOAD_DIR.mkdir(exist_ok=True)  # –°–æ–∑–¥–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

file_path = UPLOAD_DIR / "photo.jpg"  # –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø—É—Ç–∏
file_path.exists()  # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
file_path.stat().st_size  # –ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
```

---

## üéØ –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

```bash
# 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
curl -X POST "http://localhost:8000/upload/" -F "file=@cat.jpg"

# 2. –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä –Ω–∞ 500x500
curl -X POST "http://localhost:8000/process/resize/" \
  -d '{"filename": "cat.jpg", "width": 500, "height": 500}'

# 3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ PNG
curl -X POST "http://localhost:8000/process/convert/" \
  -d '{"filename": "cat.jpg", "format": "PNG"}'

# 4. –°–∫–∞—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
curl "http://localhost:8000/download/cat.png" -o cat_processed.png

# 5. –ü–æ–ª—É—á–∏—Ç—å –º–∏–Ω–∏–∞—Ç—é—Ä—É
curl "http://localhost:8000/thumbnail/cat.jpg?size=100" -o thumb.png
```

---

## üìù –ó–∞–¥–∞–Ω–∏—è –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏

1. ‚úèÔ∏è –î–æ–±–∞–≤–∏—Ç—å –ø–æ–≤–æ—Ä–æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (90¬∞, 180¬∞, 270¬∞)
2. ‚úèÔ∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—á–µ—Ä–Ω–æ-–±–µ–ª–æ–µ, —Ä–∞–∑–º—ã—Ç–∏–µ, —Ä–µ–∑–∫–æ—Å—Ç—å)
3. ‚úèÔ∏è –î–æ–±–∞–≤–∏—Ç—å –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
4. ‚úèÔ∏è –°–æ–∑–¥–∞—Ç—å endpoint –≥–∞–ª–µ—Ä–µ–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å HTML
5. ‚úèÔ∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∫–∞—á–µ—Å—Ç–≤–∞
6. ‚úèÔ∏è –î–æ–±–∞–≤–∏—Ç—å –º–∞—Å—Å–æ–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
7. ‚úèÔ∏è –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–Ω–∏–∞—Ç—é—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏

---

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "python-multipart not installed"
```bash
pip install python-multipart
```

### "Pillow not installed"
```bash
pip install Pillow
```

### "Permission denied" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞—Ç–∞–ª–æ–≥—É
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### "Image format not recognized"
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —è–≤–ª—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É

---

## üîó –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ **[–ü—Ä–∏–º–µ—Ä—É 05](../example_05/)**: Dependency Injection

**–ß—Ç–æ –¥–∞–ª—å—à–µ:**
- –ü–∞—Ç—Ç–µ—Ä–Ω Dependency Injection
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–ª–æ—è —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü–∞—Ç—Ç–µ—Ä–Ω Repository
- –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

**–†–∞–±–æ—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ - –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å –º–Ω–æ–≥–∏—Ö –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π! üñºÔ∏è**
